<div class="documents-page">
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <button class="btn btn-link text-white d-flex align-items-center" type="button" (click)="goHome()" aria-label="Home">
        <i class="bi bi-house-door-fill home-icon"></i>
      </button>
      <div class="ms-auto">
        <ul class="navbar-nav">
          <li class="nav-item dropdown user-menu" [class.show]="isMenuOpen">
            <button
              type="button"
              class="nav-link dropdown-toggle d-flex align-items-center gap-2 btn btn-link text-white"
              [attr.aria-expanded]="isMenuOpen"
              (click)="toggleUserMenu($event)">
              <span class="user-avatar">{{ getInitials(currentUser?.name) }}</span>
              <span class="user-name">{{currentUser?.name || 'Account'}}</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" [class.show]="isMenuOpen">
              <li class="dropdown-header text-muted small">{{currentUser?.email}}</li>
              <li><a class="dropdown-item" routerLink="/profile" (click)="closeUserMenu()">My Profile</a></li>
              <li><a class="dropdown-item" routerLink="/settings" (click)="closeUserMenu()">Settings</a></li>
              <li><a class="dropdown-item" routerLink="/help" (click)="closeUserMenu()">Help & Support</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><button class="dropdown-item" type="button" (click)="logout()">Sign out</button></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container-fluid p-4">
    <div class="row mb-4">
      <div class="col-md-8">
        <h2>My Documents</h2>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-8">
        <input
          type="text"
          class="form-control"
          placeholder="Search documents..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()">
      </div>
      <div class="col-md-4">
        <select class="form-select" [(ngModel)]="filterStatus" (change)="onFilterChange()">
          <option value="">All Documents</option>
          <option value="DRAFT">Draft</option>
          <option value="SIGNED">Signed</option>
          <option value="COMPLETED">Completed</option>
          <option value="PENDING">Pending</option>
          <option value="EXPIRED">Expired</option>
        </select>
      </div>
    </div>

    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div *ngIf="!loading" class="card">
      <div class="card-body">
        <div *ngIf="documents.length === 0" class="text-center py-5 text-muted">
          <i class="bi bi-file-earmark-pdf" style="font-size: 4rem;"></i>
          <p class="mt-3">No documents found. Upload your first PDF to get started!</p>
        </div>

        <table *ngIf="documents.length > 0" class="table table-hover">
          <thead>
            <tr>
              <th>File Name</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let doc of documents">
              <td>
                <i class="bi me-2" [ngClass]="getFileIcon(doc.fileName).icon + ' ' + getFileIcon(doc.fileName).color"></i>
                {{doc.fileName}}
              </td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-secondary': doc.status === 'DRAFT',
                  'bg-success': doc.status === 'SIGNED' || doc.status === 'COMPLETED',
                  'bg-warning': doc.status === 'PENDING',
                  'bg-danger': doc.status === 'EXPIRED'
                }">
                  {{doc.status}}
                </span>
              </td>
              <td>{{doc.createdAt | date:'short'}}</td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" (click)="viewDocument(doc.id)" title="View">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="btn btn-outline-success" (click)="signDocument(doc.id)" title="Sign">
                    <i class="bi bi-pen"></i>
                  </button>
                  <button class="btn btn-outline-info" (click)="downloadDocument(doc.id, doc.fileName)" title="Download">
                    <i class="bi bi-download"></i>
                  </button>
                  <button *ngIf="isWord(doc.fileName)" class="btn btn-outline-secondary" (click)="convertToPdf(doc.id, doc.fileName)" title="Convert to PDF">
                    <i class="bi bi-filetype-pdf"></i>
                  </button>
                  <button *ngIf="isPdf(doc.fileName)" class="btn btn-outline-secondary" (click)="convertToWord(doc.id, doc.fileName)" title="Convert to Word">
                    <i class="bi bi-filetype-docx"></i>
                  </button>
                  <button class="btn btn-outline-warning" (click)="emailDocument(doc.id)" title="Email">
                    <i class="bi bi-envelope"></i>
                  </button>
                  <button class="btn btn-outline-danger" (click)="deleteDocument(doc.id)" title="Delete">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
